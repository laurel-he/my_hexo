<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>贺小娇的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="贺小娇的博客">
<meta property="og:url" content="http://www.hexiaojiao.top/page/7/index.html">
<meta property="og:site_name" content="贺小娇的博客">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Laurel He">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="贺小娇的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">贺小娇的博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.hexiaojiao.top"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-20190220" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/03/05/20190220/" class="article-date">
  <time datetime="2019-03-05T05:25:21.000Z" itemprop="datePublished">2019-03-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%BF%AB%E6%8D%B7%E9%94%AE/">快捷键</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/03/05/20190220/">一些快捷键</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="navicat-for-mysql-快捷键"><a href="#navicat-for-mysql-快捷键" class="headerlink" title="navicat for mysql 快捷键"></a>navicat for mysql 快捷键</h2><p>1.ctrl+q           打开查询窗口<br>2.ctrl+/            注释sql语句<br>3.ctrl+shift +/  解除注释<br>4.ctrl+r           运行查询窗口的sql语句<br>5.ctrl+shift+r   只运行选中的sql语句<br>6.F6               打开一个mysql命令行窗口<br>7.ctrl+l            删除一行<br>8.ctrl+n           打开一个新的查询窗口<br>9.ctrl+w          关闭一个查询窗口</p>
<h2 id="phpstrom快捷键"><a href="#phpstrom快捷键" class="headerlink" title="phpstrom快捷键"></a>phpstrom快捷键</h2><p><strong>编辑</strong></p>
<table>
<thead>
<tr>
<th>快捷键</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>Ctrl + Space</td>
<td>代码自动完成（一般与输入法冲突）</td>
</tr>
<tr>
<td>Ctrl + Shift + Enter</td>
<td>智能完善代码（如:if()）</td>
</tr>
<tr>
<td>Ctrl + P</td>
<td>方法参数提示，显示默认参数</td>
</tr>
<tr>
<td>Ctrl + Q</td>
<td>显示注释代码</td>
</tr>
<tr>
<td>Ctrl + mouse over code</td>
<td>查看到简短的函数介绍</td>
</tr>
<tr>
<td>Ctrl + F1</td>
<td>显示错误或警告信息的描述（需要把光标放到错误或警告位置）</td>
</tr>
<tr>
<td>Alt + Insert</td>
<td>生成代码段（ 包括函数或类注释，版权信息，构造方法，抽象方法等）</td>
</tr>
<tr>
<td>Ctrl + O</td>
<td>插入覆盖父类的方法</td>
</tr>
<tr>
<td>Ctrl + I</td>
<td>实现抽象方法</td>
</tr>
<tr>
<td>Ctrl + Alt + T</td>
<td>选中的代码放在if..else..、for、foreach里,或者函数里，或者为选中的代码块添加区域解释（可以折叠该段代码，折叠后只显示解释，便于代码管理）</td>
</tr>
<tr>
<td>Ctrl + /</td>
<td>以添加“//”的方式添加注释</td>
</tr>
<tr>
<td>Ctrl + Shift + /</td>
<td>添加“/**/”的方式添加注释</td>
</tr>
<tr>
<td>Ctrl + W</td>
<td>增量式的选中当前块</td>
</tr>
<tr>
<td>Ctrl + Shift + W</td>
<td>与Ctrl + W对应，减小选中范围</td>
</tr>
<tr>
<td>Alt + Q</td>
<td>显示包含光标所在位置的标签头</td>
</tr>
<tr>
<td>Alt + Enter</td>
<td>显示意图行动。 Show Intention Action</td>
</tr>
<tr>
<td>Ctrl + Alt + L</td>
<td>格式化代码</td>
</tr>
<tr>
<td>Ctrl + Alt + I</td>
<td>自动缩进。</td>
</tr>
<tr>
<td>Tab / Shift + Tab</td>
<td>手动缩进/反向缩进</td>
</tr>
<tr>
<td>Ctrl + X or Shift + Delete</td>
<td>剪切</td>
</tr>
<tr>
<td>Ctrl + C or Ctrl + Insert</td>
<td>复制</td>
</tr>
<tr>
<td>Ctrl + V or Shift + Insert</td>
<td>粘贴</td>
</tr>
<tr>
<td>Ctrl + Shift + V</td>
<td>从粘贴板中选择内容进行粘贴</td>
</tr>
<tr>
<td>Ctrl + D</td>
<td>将当前行或者选择的内容复制到下一行或光标处</td>
</tr>
<tr>
<td>Ctrl + Y</td>
<td>删除光标所在的行</td>
</tr>
<tr>
<td>Ctrl + Shift + J</td>
<td>合成选中代码到一行。格式化代码的反向动作</td>
</tr>
<tr>
<td>Ctrl + Enter</td>
<td>智能线分割</td>
</tr>
<tr>
<td>Shift + Enter</td>
<td>另起一新行。无论光标在行的那个位置</td>
</tr>
<tr>
<td>Ctrl + Shift + U</td>
<td>字符大小写切换</td>
</tr>
<tr>
<td>Ctrl + Shift + ] / [</td>
<td>以区块为单位，从光标处 向后/向前 选择，再次点击增加选择范围</td>
</tr>
<tr>
<td>Ctrl + Delete</td>
<td>删除光标之后的部分单词</td>
</tr>
<tr>
<td>Ctrl + Backspace</td>
<td>删除光标之前的部分单词</td>
</tr>
<tr>
<td>Ctrl + +/-</td>
<td>折叠/打开代码块，再次点击扩大折叠/打开范围</td>
</tr>
<tr>
<td>Ctrl + Shift +  +</td>
<td>打开全部</td>
</tr>
<tr>
<td>Ctrl + Shift +  -</td>
<td>折叠全部</td>
</tr>
<tr>
<td>Ctrl + F4</td>
<td>关闭当前页面</td>
</tr>
<tr>
<td><strong>搜索/替换</strong></td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>快捷键</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>Ctrl + F</td>
<td>查找</td>
</tr>
<tr>
<td>F3</td>
<td>查找下一个，结合查找使用</td>
</tr>
<tr>
<td>Shift + F3</td>
<td>查找前一个，结合查找使用</td>
</tr>
<tr>
<td>Ctrl + R</td>
<td>替换</td>
</tr>
<tr>
<td>Ctrl + Shift + F</td>
<td>在文件中查找</td>
</tr>
<tr>
<td>Ctrl + Shift + R</td>
<td>在文件中替换</td>
</tr>
<tr>
<td><strong>被使用搜索</strong></td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>快捷键</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>Alt + F7 / Ctrl + F7</td>
<td>全项目被使用查找/当前文件声明变量处</td>
</tr>
<tr>
<td>Ctrl + Shift + F7</td>
<td>在文件中变量或函数被使用处高亮</td>
</tr>
<tr>
<td>Ctrl + Alt + F7</td>
<td>显示详细被使用的位置列表</td>
</tr>
</tbody></table>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.hexiaojiao.top/2019/03/05/20190220/" data-id="cka4vkt1a000dg4am69f36vl8" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%96%87%E6%A1%A3/" rel="tag">文档</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-20190213" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/03/02/20190213/" class="article-date">
  <time datetime="2019-03-02T05:25:21.000Z" itemprop="datePublished">2019-03-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Python/">Python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/03/02/20190213/">分析bi数据获取流程</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="一：导入数据"><a href="#一：导入数据" class="headerlink" title="一：导入数据"></a>一：导入数据</h3><h4 id="1-bi-etl-通过定时任务脚本将数据从源数据库导出："><a href="#1-bi-etl-通过定时任务脚本将数据从源数据库导出：" class="headerlink" title="1. bi_etl:通过定时任务脚本将数据从源数据库导出："></a>1. bi_etl:通过定时任务脚本将数据从源数据库导出：</h4><p>（1） 修改配置文件，执行dump_order.sh，导入部分测试数据<br>（2）其中mysqldump导出数据到文件中<br>（3）shell无法直接执行source，可以用bash来操作，命令：sudo bash dump_order.sh<br>（4）sh文件可能是在windows下面编辑的，在vim中使用set fileformat=unix 去除\M字符<br>（5）运行sh文件可在data目录下生成sql文件<br>（6）注意事项：<br>    为什么不使用增量：因为有个中间表没有update_at，financial的表不能随意加字段</p>
<p><strong>1-1修改:</strong><br>（1）第一步导数据，源数据（来自于order_system）已经执行了删除五张表的三个字段，因此导出的数据结构和以前导出的数据结构是不一样的；</p>
<h4 id="2-通过jump-server将bi-etl的数据文件导出到bi-new的upload中-本地无法部署"><a href="#2-通过jump-server将bi-etl的数据文件导出到bi-new的upload中-本地无法部署" class="headerlink" title="2. 通过jump server将bi_etl的数据文件导出到bi_new的upload中(本地无法部署)**"></a>2. 通过jump server将bi_etl的数据文件导出到bi_new的upload中(本地无法部署)**</h4><p>（1）由于本地无法直接部署jump server,直接拷贝刚才生成的文件到bi_new的upload中；<br>（2）load_new.sh文件读取的是data.tar.gz压缩文件，因此直接压缩整个data文件夹到upload文件夹下</p>
<h4 id="3-bi-dsvcs读取数据并存入bi-new数据库"><a href="#3-bi-dsvcs读取数据并存入bi-new数据库" class="headerlink" title="3. bi_dsvcs读取数据并存入bi_new数据库"></a>3. bi_dsvcs读取数据并存入bi_new数据库</h4><p>（1）修改配置文件（不修改可能会覆盖线上数据）<br>（2）执行脚本并去除\M字符(会读取conf文件，set ff=unix可以去除/r字符)<br>（2）在load_new.sh脚本中（使用了mysql的source命令）将刚才文件中的数据导入ori_new数据库中<br>（4）注意事项：sh文件中使用了tar -xvf 解压data文件，但是实际上没有解压成功，文件不存在，可以直接复制所有文件</p>
<p><strong>3-2修改：</strong><br>（1）执行sql命令直接修改ori_new的结构，命令如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> ori_new;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="string">`order_product`</span> <span class="keyword">add</span> <span class="string">`departure_date`</span> <span class="built_in">date</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="string">`order_product`</span> <span class="keyword">add</span> <span class="string">`end_date`</span> <span class="built_in">date</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="string">`order_product`</span> <span class="keyword">add</span> <span class="string">`product_status`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'10000'</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="string">`order_order_product_combine`</span> <span class="keyword">drop</span> <span class="keyword">column</span> <span class="string">`departure_date`</span>, <span class="keyword">drop</span> <span class="keyword">column</span> <span class="string">`end_date`</span>, <span class="keyword">drop</span> <span class="keyword">column</span> <span class="string">`product_status`</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="string">`order_order_product_customize`</span> <span class="keyword">drop</span> <span class="keyword">column</span> <span class="string">`departure_date`</span>, <span class="keyword">drop</span> <span class="keyword">column</span> <span class="string">`end_date`</span>, <span class="keyword">drop</span> <span class="keyword">column</span> <span class="string">`product_status`</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="string">`order_order_product_hotel`</span> <span class="keyword">drop</span> <span class="keyword">column</span> <span class="string">`departure_date`</span>, <span class="keyword">drop</span> <span class="keyword">column</span> <span class="string">`end_date`</span>, <span class="keyword">drop</span> <span class="keyword">column</span> <span class="string">`product_status`</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="string">`order_order_product_oneday`</span> <span class="keyword">drop</span> <span class="keyword">column</span> <span class="string">`departure_date`</span>, <span class="keyword">drop</span> <span class="keyword">column</span> <span class="string">`end_date`</span>, <span class="keyword">drop</span> <span class="keyword">column</span> <span class="string">`product_status`</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="string">`order_order_product_ticket`</span> <span class="keyword">drop</span> <span class="keyword">column</span> <span class="string">`departure_date`</span>, <span class="keyword">drop</span> <span class="keyword">column</span> <span class="string">`end_date`</span>, <span class="keyword">drop</span> <span class="keyword">column</span> <span class="string">`product_status`</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="string">`order_order_product_tour`</span> <span class="keyword">drop</span> <span class="keyword">column</span> <span class="string">`departure_date`</span>, <span class="keyword">drop</span> <span class="keyword">column</span> <span class="string">`end_date`</span>, <span class="keyword">drop</span> <span class="keyword">column</span> <span class="string">`product_status`</span>;</span><br></pre></td></tr></table></figure>
<h4 id="4-bi-dpsvc将数据从ori-new中导入到bi库中并合并部分数据"><a href="#4-bi-dpsvc将数据从ori-new中导入到bi库中并合并部分数据" class="headerlink" title="4. bi_dpsvc将数据从ori_new中导入到bi库中并合并部分数据"></a>4. bi_dpsvc将数据从ori_new中导入到bi库中并合并部分数据</h4><p>（1）module/order.py:__get_order_product_line_table:定义了操作的五张表：<br>order_order_product_oneday、order_order_product_tour，order_order_product_ticket，order_order_product_hotel，order_order_product_combine<br>order_product_tff表从ori_new就没有导入；order_product_customize单独操作<br>（2）class OrderProduct </p>
<p><strong>4-2修改：</strong><br>（1）bi数据库的order_product表不存在end_date,departure_date两个字段；order_product_customize存在这两个字段，修改方法如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> bi;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="string">`order_product`</span> <span class="keyword">add</span> <span class="string">`departure_date`</span> <span class="built_in">date</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="string">`order_product`</span> <span class="keyword">add</span> <span class="string">`end_date`</span> <span class="built_in">date</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="string">`order_order_product_customize`</span> <span class="keyword">drop</span> <span class="keyword">column</span> <span class="string">`departure_date`</span>, <span class="keyword">drop</span> <span class="keyword">column</span> <span class="string">`end_date`</span>, <span class="keyword">drop</span> <span class="keyword">column</span> <span class="string">`product_status`</span>;</span><br></pre></td></tr></table></figure>
<p> （2）修改代码</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.hexiaojiao.top/2019/03/02/20190213/" data-id="cka4vkt170008g4am9xot1f3u" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B7%A5%E4%BD%9C/" rel="tag">工作</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-20190214" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/03/02/20190214/" class="article-date">
  <time datetime="2019-03-02T05:25:21.000Z" itemprop="datePublished">2019-03-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Python/">Python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/03/02/20190214/">Monthly报表完成步骤</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-计算规则（都在订单产品维度）"><a href="#1-计算规则（都在订单产品维度）" class="headerlink" title="1 计算规则（都在订单产品维度）"></a>1 计算规则（都在订单产品维度）</h2><h4 id="1-已收"><a href="#1-已收" class="headerlink" title="1 已收"></a>1 已收</h4><p>（1）计算此订单产品所在的订单的所有已收款<br>（2）计算此订单产品所在的订单有多少订单产品<br>（3）所有已收款除以订单产品数量，平均得出每个订单产品的已收款</p>
<h2 id="2-基础接口实现"><a href="#2-基础接口实现" class="headerlink" title="2 基础接口实现"></a>2 基础接口实现</h2><h4 id="1-注意事项"><a href="#1-注意事项" class="headerlink" title="1 注意事项"></a>1 注意事项</h4><p>每次更新代码supervisor都需要重启</p>
<h4 id="2-添加路由和方法"><a href="#2-添加路由和方法" class="headerlink" title="2 添加路由和方法"></a>2 添加路由和方法</h4><p>创建finance_monthly controller,并在dsvcs.py中引入</p>
<h4 id="3-导入bill表"><a href="#3-导入bill表" class="headerlink" title="3 导入bill表"></a>3 导入bill表</h4><p>需要导入bill和bill_item表进ori_new以及bi表中</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.hexiaojiao.top/2019/03/02/20190214/" data-id="cka4vkt180009g4am420se16w" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B7%A5%E4%BD%9C/" rel="tag">工作</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-vim" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/28/vim/" class="article-date">
  <time datetime="2019-02-28T08:34:10.000Z" itemprop="datePublished">2019-02-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%BF%AB%E6%8D%B7%E9%94%AE/">快捷键</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/02/28/vim/">vim学习笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="光标移动"><a href="#光标移动" class="headerlink" title="光标移动"></a>光标移动</h2><p>h 或 &lt;- 表示向左<br>j 下<br>k 上<br>l 右</p>
<p>ctrl + f     屏幕向下移动一页<br>ctrl + b     向上移动一页<br>ctrl + d     向下移动半页<br>ctrl + u     向上移动半页<br>‘+’          光标移动到非空格符的下一行<br>‘-‘          光标移动到非空格符的<br>n[space]   n表示数字，光标向右移动n个字符<br>0或[Home]  移动到这一行最开始的字符处<br>$或[End]   移动到这一行的最后面字符处<br>H          移动到这个屏幕最上方一行的第一个字符<br>M          移动到这个屏幕中央一行的第一个字符<br>L          移动到这个屏幕最下方一行的第一个字符<br>G          移动到这个文件的最后一行<br>nG(:n)     移动到这个文件的第n行<br>gg(1G)     移动到第一行<br>n[Enter]   n为数字，表示向下移动n行</p>
<h2 id="查找与替换"><a href="#查找与替换" class="headerlink" title="查找与替换"></a>查找与替换</h2><p>/word 光标之下寻找名为word的字符串<br>?word 光标之上寻找名为word的字符串<br>n     重复前一个查找的操作<br>N     反向进行前一个查找操作<br>:n1,n2s/word1/word2/g    n1和n2是数字，在n1和n2行之间查找所有word,替换成word2<br>:1,$s/word1/word2/g<br>:1,$s/word1/word2/gc     c代表confirm,替换前显示确认信息</p>
<h2 id="删除复制与粘贴"><a href="#删除复制与粘贴" class="headerlink" title="删除复制与粘贴"></a>删除复制与粘贴</h2><p>x       向后删除<br>X       向前删除<br>nx      向后删除n个字符<br>dd      删除（剪切）光标所在一整行<br>ndd     删除向下n行<br>d1G     删除光标所在到第一行的数据<br>dG      删除光标所在到最后一行的数据<br>d$      删除光标所在处，到该行最后一个字符<br>d0<br>yy      复制该行<br>nyy<br>y1G<br>yG<br>y0<br>y$<br>p       将已复制的数据在光标下一行粘贴<br>P       上一行<br>J       光标所在行与下一行数据结合成同一行<br>c       重复删除多个数据(10cj代表向下删除10行)删除后切换到编辑模式<br>u       回复<br>ctrl+r  重做<br>.       重复前一次操作</p>
<h2 id="进入插入或替换的编辑模式"><a href="#进入插入或替换的编辑模式" class="headerlink" title="进入插入或替换的编辑模式"></a>进入插入或替换的编辑模式</h2><p>i I     i从目前光标所在处插入，I目前所在行的第一个非空格字符处开始插入<br>a A     a 从目前光标所在的下一个字符处开始插入,A从光标所在行的最后一个字符处开始插入<br>o O     o 在目前光标所在行的下一行处插入新行  O上一行<br>r R     r 替换一次 R 一直替换直到按Esc</p>
<h2 id="一般命令模式切换到命令模式"><a href="#一般命令模式切换到命令模式" class="headerlink" title="一般命令模式切换到命令模式"></a>一般命令模式切换到命令模式</h2><p>ZZ      若文件没有被修改则不保存退出，修改了则保存后退出<br>:w [filename] 将编辑的数据保存成另一个新文件<br>:r [filename] 读入另一个文件的数据，加在光标所在行后面<br>:n1, n2 w [filename] 将n1到n2的内容保存到文件<br>:! command 暂时退出vi到命令行模式下执行command的显示结果（:! ls /home）<br>:set nu<br>:set nonu<br>:e! 还原文件内容事实上，可以使用[ :! ls /home ]不过，如果你学过后面的章节之后，你会发现，执行[ ctrl + z ]亦可暂时退出 vi 让你在命令行</p>
<p>##多行添加数据</p>
<p><strong>方法一：块选择模式</strong><br>（1）v 进入virtual模式<br>（2）上下键选择需要注释的行数<br>（3）ctrl+v 进入列模式<br>（4）大写I进入插入模式，输入要编辑的符号<br>（5）立即按下两次ESC<br><strong>方法二：替换命令</strong><br>：起始行号，结束行号s/^/注释符/g<br>取消注释：<br>:起始行号,结束行号s/^注释符//g</p>
<p>####编辑多行</p>
<p>ctrl+v进入visual block模式，按两次j或者2j，将光标移动到要插入的最后一行，按下i进入编辑模式。输入内容，Esc退出</p>
<p>##多文件编辑</p>
<p>:n 编辑下一个文件<br>:N 编辑上一个文件<br>:files 列出目前这个vim打开的所有文件<br>（nyy复制后，使用p粘贴）</p>
<p>##多窗口功能</p>
<p><strong>分区窗口并放入文件</strong><br>:sp {filename}</p>
<h4 id="按键功能介绍"><a href="#按键功能介绍" class="headerlink" title="按键功能介绍"></a>按键功能介绍</h4><p>:sp [filename] 打开一个新窗口，如果加filename表示打开另一个文件，否则打开自身<br>[ctrl] + w + j 或[ctrl] + w + ↓：先按住ctrl键不放，按下w后放开，之后再按↓或↑<br>ctrl + w + q 相当于切换到某个窗口，按下:q离开，也可以直接ctrl+w+q</p>
<p>##vim的挑字补全功能</p>
<p>ctrl + x -&gt; ctrl + n 通过正在编辑的这个文件的内容文字作为关键组予以补齐<br>ctrl + x -&gt; ctrl + f 以当前目录的文件名作为关键字予以补齐<br>ctrl + x -&gt; ctrl + o 以扩展名作为语法补充，以vim内置的关键字予以补齐</p>
<h4 id="vim-自动补全报错option-‘omnifunc’-is-not-set"><a href="#vim-自动补全报错option-‘omnifunc’-is-not-set" class="headerlink" title="vim 自动补全报错option ‘omnifunc’ is not set"></a>vim 自动补全报错option ‘omnifunc’ is not set</h4><p>编辑vimrc文件，加入以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">autocmd FileType python set omnifunc&#x3D;pythoncomplete#Complete</span><br><span class="line">autocmd FileType javascript set omnifunc&#x3D;javascriptcomplete#CompleteJS</span><br><span class="line">autocmd FileType html set omnifunc&#x3D;htmlcomplete#CompleteTags</span><br><span class="line">autocmd FileType css set omnifunc&#x3D;csscomplete#CompleteCSS</span><br><span class="line">autocmd FileType xml set omnifunc&#x3D;xmlcomplete#CompleteTags</span><br><span class="line">autocmd FileType php set omnifunc&#x3D;phpcomplete#CompletePHP</span><br><span class="line">autocmd FileType c set omnifunc&#x3D;ccomplete#Complete</span><br></pre></td></tr></table></figure>

<p>##编码转换</p>
<p>iconv list:列出所有的编码<br>iconv -f 原本编码 -t 新编码 filename [-o newfilw]<br>##vim的环境设置参数</p>
<p>:set no或者:set number<br>:set hlsearch 设置高亮度搜寻<br>:set nohlsearch<br>:set autoindent 自动缩进<br>:set noautoindent 设置不自动缩进<br>:set backup 设置自动储存备份文件，一般设置为nobackup，如果为backup，每次更改一个文件时会自动产生一个<code>filename~</code>文件记录原始文件内容<br>:set ruler 显示右下角状态列<br>:set showmode 是否要显示–INSERT–之类的字眼<br>:set backspace=(012) 某些distribution不允许使用backspace删除字符，当设置值为2可以删除任意值，为0或1时，只能删除刚才输入的<br>:set all 显示目前所有的环境参数设置值<br>:set 显示与系统默认值不同的设置参数<br>:syntax on 程序相关语法显示不同颜色<br>:syntax off<br>:set bg=dark 显示不同的颜色色调<br>:set bg=light 编辑’~/.vimrc’文件，有或没有冒号都可以</p>
<p>##其他相关操作<br><strong>virtualbox添加共享文件</strong><br>1 设置-添加共享文件，选择固定分配<br>2 添加挂载：sudo mount -t vboxsf rezb2b /mnt/rezb2b<br>3 自启动挂载命令：sudo vim /etc/rc.local 添加命令</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.hexiaojiao.top/2019/02/28/vim/" data-id="cka4vkt4n005jg4ambx3261vq" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%96%87%E6%A1%A3/" rel="tag">文档</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-20190227" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/28/20190227/" class="article-date">
  <time datetime="2019-02-28T03:03:10.000Z" itemprop="datePublished">2019-02-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>►<a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Hbase/">Hbase</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/02/28/20190227/">Hbase基础命令</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Hbase基础命令"><a href="#Hbase基础命令" class="headerlink" title="Hbase基础命令"></a>Hbase基础命令</h2><h4 id="启动和停止Hbase"><a href="#启动和停止Hbase" class="headerlink" title="启动和停止Hbase"></a>启动和停止Hbase</h4><p><strong>启动</strong><br>hbase/bin  ./start-hbase.sh<br><strong>关闭</strong><br>hbase/bin   ./stop-hbase.sh</p>
<h4 id="使用Hbase"><a href="#使用Hbase" class="headerlink" title="使用Hbase"></a>使用Hbase</h4><p><strong>连接Hbase</strong><br>bin/hbase shell<br><strong>创建表</strong><br>create ‘test’ （创建表需要添加列簇）<br>create ‘表名’ ‘列簇名1’ ‘列簇名2’ ……<br><strong>添加数据</strong><br>put ‘表名’ ‘行名’ ‘列簇名称’ ‘value’（当列簇只有一列）<br>put ‘表名’ ‘行名’ ‘列簇名称：列名称’ ‘value’<br><strong>查看表</strong><br>list: 查看所有表<br>list ‘tablename’ ： 查看表名为tablename的表<br><strong>删除表</strong><br>disable ‘表名’(对应enable ‘明白’)<br>drop ‘表名’</p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>####基础配置<br>conf/hbase-site.xml</p>
<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>（1）表名，行，列都必须用引号括起来</p>
<img  src=http://www.plantuml.com/plantuml/svg/>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.hexiaojiao.top/2019/02/28/20190227/" data-id="cka4vkt1g000kg4am4zxc00p0" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" rel="tag">基础命令</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2019-02-26" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/26/2019-02-26/" class="article-date">
  <time datetime="2019-02-26T08:10:10.000Z" itemprop="datePublished">2019-02-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Python/">Python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/02/26/2019-02-26/">Monthly报表完成心得</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-知识点"><a href="#1-知识点" class="headerlink" title="1 知识点"></a>1 知识点</h2><h4 id="添加日志"><a href="#添加日志" class="headerlink" title="添加日志"></a>添加日志</h4><p>引入logging包，引入log文件即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging.basicConfig(filename&#x3D;&quot;&#x2F;tmp&#x2F;bi_dsvcs&#x2F;app.log&quot;, level &#x3D; logging.DEBUG)</span><br></pre></td></tr></table></figure>
<p>有四种级别INFO, DEBUG, WARNING, ERROR, CRITICAL, FATAL</p>
<h4 id="获取月份列表"><a href="#获取月份列表" class="headerlink" title="获取月份列表"></a>获取月份列表</h4><p><strong>需求</strong><br>需要获取月份数据[‘00’, ‘01’, ‘02’, ‘03’, ‘04’, ‘05’, ‘06’, ‘07’, ‘08’, ‘09’, ‘10’, ‘11’]<br><strong>原本解决办法</strong><br>直接定义了一个这样的数组<br><strong>新方法</strong><br>range()从0到13，再在一位数前补零<br><strong>实现代码</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">theMonth &#x3D; range(0, 13)</span><br><span class="line">monthKey &#x3D; map(lambda x:&#39;%02d&#39; % x, theMonth)</span><br></pre></td></tr></table></figure>
<p><strong>新方法2</strong><br>[“%02d” % x for x in range(1,13)]</p>
<h4 id="数据库导入导出"><a href="#数据库导入导出" class="headerlink" title="数据库导入导出"></a>数据库导入导出</h4><p>shell脚本里添加mysqldump导出数据<br>导入数据为避免更改表结构，直接mysql -u……连接到库，执行insert操作</p>
<h4 id="gunicorn配置"><a href="#gunicorn配置" class="headerlink" title="gunicorn配置"></a>gunicorn配置</h4><p>使用supervisor配置gunicorn，我本地虚拟机配置如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[program:bi_dsvcs]</span><br><span class="line">command&#x3D;python &#x2F;usr&#x2F;bin&#x2F;gunicorn -c &#x2F;spython&#x2F;bi_dsvcs&#x2F;gunicorn.cnf dsvcs:app</span><br><span class="line">process_name&#x3D;%(program_name)s&#x2F;%(process_num)d</span><br><span class="line">directory&#x3D;&#x2F;spython&#x2F;bi_dsvcs</span><br><span class="line">numprocs&#x3D;1</span><br><span class="line">autostart&#x3D;true</span><br><span class="line">autorestart&#x3D;true</span><br><span class="line">user&#x3D;developer</span><br><span class="line">redirect_stderr&#x3D;true</span><br><span class="line">stdout_logfile&#x3D;&#x2F;tmp&#x2F;bi_dsvcs.interface.info_stdout.log</span><br><span class="line">stderr_logfile&#x3D;&#x2F;tmpbi_dsvcs.interface.error_stderr.loga</span><br></pre></td></tr></table></figure>
<p>##2 注意事项</p>
<h4 id="group-concat"><a href="#group-concat" class="headerlink" title="group_concat"></a>group_concat</h4><p>GROUP_CONCAT()会截断数据，限制长度为1024字节</p>
<h4 id="dict"><a href="#dict" class="headerlink" title="dict"></a>dict</h4><p>dict不可以直接添加二维数据,需要判断第一维是否已经存在</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def addtwodimdict(thedict, key_a, key_b, val): </span><br><span class="line">    if key_a in adic:</span><br><span class="line">        thedict[key_a].update(&#123;key_b: val&#125;)</span><br><span class="line">    else:</span><br><span class="line">        thedict.update(&#123;key_a:&#123;key_b: val&#125;&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="list的append-和extend-区别"><a href="#list的append-和extend-区别" class="headerlink" title="list的append()和extend()区别"></a>list的append()和extend()区别</h4><p>(1)append()<br>接受任意数据类型添加到list尾部<br>(2)extend()<br>只接受list，将这个list每个元素添加到list中</p>
<h4 id="部署后404但是代码确实已部署上去"><a href="#部署后404但是代码确实已部署上去" class="headerlink" title="部署后404但是代码确实已部署上去"></a>部署后404但是代码确实已部署上去</h4><p>supervisor可能没有重启，重启supervisor或者直接bi_dsvcs/ ./dsvcs restart </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.hexiaojiao.top/2019/02/26/2019-02-26/" data-id="cka4vkt0v0002g4am33ls492n" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B7%A5%E4%BD%9C/" rel="tag">工作</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-20190202" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/02/20190202/" class="article-date">
  <time datetime="2019-02-02T05:25:21.000Z" itemprop="datePublished">2019-02-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Python/">Python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/02/02/20190202/">python100例学习笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="四个数组成不重复三位数"><a href="#四个数组成不重复三位数" class="headerlink" title="四个数组成不重复三位数"></a>四个数组成不重复三位数</h2><p><strong>描述</strong><br>有四个数字，1,2,3,4，能组成多少个不重复的三位数<br><strong>思考</strong><br>原文分析：将所有的数字排列组合后去掉不满足条件的列<br><strong>代码</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">num &#x3D; 1;</span><br><span class="line">for i in range(1,5):</span><br><span class="line">    for j in range(1,5):</span><br><span class="line">        for k in range(1,5):</span><br><span class="line">            if(i !&#x3D; k) and (i !&#x3D; j) and (j !&#x3D; k): </span><br><span class="line">                print i,j,k</span><br><span class="line">                num &#x3D; num + 1 </span><br><span class="line">print num</span><br></pre></td></tr></table></figure>
<p><strong>扩展</strong><br>循环三次效率很低，每次循环都是1-5，有没有更好的解决办法</p>
<h2 id="2"><a href="#2" class="headerlink" title="2"></a>2</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.hexiaojiao.top/2019/02/02/20190202/" data-id="cka4vkt150007g4am72ci80ij" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0/" rel="tag">学习</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2019_01_01" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/01/2019_01_01/" class="article-date">
  <time datetime="2019-02-01T08:10:10.000Z" itemprop="datePublished">2019-02-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/02/01/2019_01_01/">各种奇怪的坑</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="1-strtotime"><a href="#1-strtotime" class="headerlink" title="1 strtotime()"></a>1 strtotime()</h4><p><strong>描述</strong><br>获取上个月的时间可以是date(‘Y-m-d’,strtotime(‘-1 month’));如果今天是31号而上个月没有31号，就会直接输出这个月1号；<br><strong>解决办法</strong><br>使用last day of -1 month来获取上个月的最后一天</p>
<h4 id="2-php-字符串和数字比较"><a href="#2-php-字符串和数字比较" class="headerlink" title="2 php 字符串和数字比较"></a>2 php 字符串和数字比较</h4><p><strong>描述</strong><br>遇到一个问题，传过来的参数可能是0，可能是字符串，然后与0作比较，但是当传递的参数是字符串时，与0比较，结果是true<br><strong>解决办法</strong><br>直接与’0’比较。0===’0’可以返回true,可以直接比较，字符串与’0’比较也不等</p>
<h4 id="3-virtualbox共享文件夹不能执行virtualenv-env，只能在其他文件夹下运行，暂时没想到解决办法"><a href="#3-virtualbox共享文件夹不能执行virtualenv-env，只能在其他文件夹下运行，暂时没想到解决办法" class="headerlink" title="3 virtualbox共享文件夹不能执行virtualenv env，只能在其他文件夹下运行，暂时没想到解决办法"></a>3 virtualbox共享文件夹不能执行virtualenv env，只能在其他文件夹下运行，暂时没想到解决办法</h4><p>virtualbox的共享文件夹有保护机制，不允许直接运行virtualenv env，只能在其他文件夹下运行,解决办法：<br>硬链接</p>
<h4 id="4-laravel-get-gt-toArray-无法获取数据"><a href="#4-laravel-get-gt-toArray-无法获取数据" class="headerlink" title="4 laravel get()-&gt;toArray()无法获取数据"></a>4 laravel get()-&gt;toArray()无法获取数据</h4>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.hexiaojiao.top/2019/02/01/2019_01_01/" data-id="cka4vkt1c000fg4amfkuvc7ga" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0/" rel="tag">学习</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-test-my-site" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/31/test-my-site/" class="article-date">
  <time datetime="2019-01-31T09:36:10.000Z" itemprop="datePublished">2019-01-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/31/test-my-site/">fastadmin自定义角色组</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>之前使用fastadmin，自定义角色组，发现编辑/删除/修改等等权限可以直接权限管理中选择，然后用不同的角色登陆，会显示对应的权限按钮。此时有一个新的需求就是增加审核和批量审核，并且也增加对应的权限。</p>
<hr>
<p>添加按钮<br>    先不写功能，在对应的位置上加上审核按钮。在顶头位置的批量审核需要得到的样式如下：</p>
<p><img src="https://image-static.segmentfault.com/105/121/1051217979-5b03e62334d57_articlex" alt="clipboard.png"></p>
<blockquote>
<p> 原先的创建按钮方法为：<br>    {:build_toolbar(‘refresh,edit,checkall’)}<br>有时候不使用buid_toolbar来创建按钮，而是直接使用的</p>
<pre><code>&lt;a href=&quot;javascript:;&quot; class=&quot;btn btn-danger btn-del btn-disabled disabled {:$auth-&gt;check(&apos;course/clabelong/del&apos;)?&apos;&apos;:&apos;hide&apos;}&quot;</code></pre><p>title=”{:<strong>(‘Delete’)}” &gt;<i class="fa fa-trash"></i><br>{:</strong>(‘Delete’)}</a></p>
</blockquote>
<p>这种方式来创建按钮，这样虽然很直观，但是实际上使用却很不方便，因为这里对于权限的判定可能是有问题的。期待的结果是直接使用build_toolbar方法，设置checkall为批量审核，check为审核方法，对于各个权限组可以直接调用。<br>修改build_toolbar方法到如下结果：</p>
<pre><code>function build_toolbar($btns = NULL, $attr = [])
    {
        $auth = \app\admin\library\Auth::instance();
        $controller = str_replace(&apos;.&apos;, &apos;/&apos;, strtolower(think\Request::instance()-&gt;controller()));
        $btns = $btns ? $btns : [&apos;refresh&apos;, &apos;add&apos;, &apos;edit&apos;, &apos;del&apos;, &apos;import&apos;,&apos;checkall&apos;];
        $btns = is_array($btns) ? $btns : explode(&apos;,&apos;, $btns);
        $index = array_search(&apos;delete&apos;, $btns);
        if ($index !== FALSE) {
            $btns[$index] = &apos;del&apos;;
        }
        $btnAttr = [
            &apos;refresh&apos; =&gt; [&apos;javascript:;&apos;, &apos;btn btn-primary btn-refresh&apos;, &apos;fa fa-refresh&apos;, &apos;&apos;, __(&apos;Refresh&apos;)],
            &apos;checkall&apos;=&gt; [&apos;javascript:;&apos;, &apos;btn btn-success btn-checkall btn-disabled disabled&apos;, &apos;fa fa-flag-checkered&apos;, &apos; 批量审核&apos;, &apos;批量审核&apos;],
            &apos;add&apos;     =&gt; [&apos;javascript:;&apos;, &apos;btn btn-success btn-add&apos;, &apos;fa fa-plus&apos;, __(&apos;Add&apos;), __(&apos;Add&apos;)],
            &apos;edit&apos;    =&gt; [&apos;javascript:;&apos;, &apos;btn btn-success btn-edit btn-disabled disabled&apos;, &apos;fa fa-pencil&apos;, __(&apos;Edit&apos;), __(&apos;Edit&apos;)],
            &apos;del&apos;     =&gt; [&apos;javascript:;&apos;, &apos;btn btn-danger btn-del btn-disabled disabled&apos;, &apos;fa fa-trash&apos;, __(&apos;Delete&apos;), __(&apos;Delete&apos;)],
            &apos;import&apos;  =&gt; [&apos;javascript:;&apos;, &apos;btn btn-danger btn-import&apos;, &apos;fa fa-upload&apos;, __(&apos;Import&apos;), __(&apos;Import&apos;)],
        ];
        $btnAttr = array_merge($btnAttr, $attr);
        $html = [];
        foreach ($btns as $k =&gt; $v) {
            //如果未定义或没有权限
            if (!isset($btnAttr[$v]) || ($v !== &apos;refresh&apos; &amp;&amp; !$auth-&gt;check(&quot;{$controller}/{$v}&quot;))) {
                continue;
            }
            list($href, $class, $icon, $text, $title) = $btnAttr[$v];
            $extend = $v == &apos;import&apos; ? &apos;id=&quot;btn-import-file&quot; data-url=&quot;ajax/upload&quot; data-mimetype=&quot;csv,xls,xlsx&quot; data-multiple=&quot;false&quot;&apos; : &apos;&apos;;
            $html[] = &apos;&lt;a href=&quot;&apos; . $href . &apos;&quot; class=&quot;&apos; . $class . &apos;&quot; title=&quot;&apos; . $title . &apos;&quot; &apos; . $extend . &apos;&gt;&lt;i class=&quot;&apos; . $icon . &apos;&quot;&gt;&lt;/i&gt; &apos; . $text . &apos;&lt;/a&gt;&apos;;
        }
        return implode(&apos; &apos;, $html);
    }</code></pre><p>具体修改的就是两个地方，第一个是数组$btns，在$btns数组中添加需要的元素，在本例中添加checkall;第二就是修改$btnAttr，根据需要添加一个checkall元素，如下所示：</p>
<blockquote>
<p>‘checkall’=&gt; [‘javascript:;’, ‘btn btn-success btn-checkall<br>btn-disabled disabled’, ‘fa fa-flag-checkered’, ‘ 批量审核’, ‘批量审核’],</p>
</blockquote>
<p>这里有需要特别注意的地方是，最好在类中加上<strong>btn-disabled disabled</strong>两个class,这样可以方便直接获取是否选择。也就是说，在没有选择项的情况下，所有批量操作的按钮都应该是不能点击的。<br>在修改完buildtoolbar之后在页面上使用应该就是可以直接调用出来了，到此第一步完成。</p>
<hr>
<p>修改js配置</p>
<p>接下来修改require-table.js文件，因为所有的后台js文件都继承了这个文件，如果用的编辑器或IDE没有历史记录功能那就一定要做好备份。<br>    首先是配置项，extend项代表每个url对应的方法，这里可以设置成缺省为空，然后在需要用到的js文件中再调用。加上checkall和check的URL，最好命名一致，修改完成的extend如下：<br>    extend: {<br>                index_url: ‘’,<br>                add_url: ‘’,<br>                edit_url: ‘’,<br>                del_url: ‘’,<br>                import_url: ‘’,<br>                multi_url: ‘’,<br>                check_url:’’,<br>                checkall_url:’’,<br>                check_classes_url:’’,<br>                dragsort_url: ‘ajax/weigh’,<br>            }<br>只需要按自己的需求把想加的公共方法加上，在config中添加按钮对应的class,比如这里添加：</p>
<pre><code>checkallbtn: &apos;.btn-checkall&apos;,</code></pre><p>绑定事件<br>在bindevent中添加事件如下：</p>
<pre><code>// 批量审核按钮事件
$(toolbar).on(&apos;click&apos;, Table.config.checkallbtn, function () {
    var that = this;
    var ids = Table.api.selectedids(table);
    layer.msg(&apos;您正在批量修改审核状态，请选择结果&apos;, {
        time: 20000, //20s后自动关闭
        btn: [&apos;通过&apos;, &apos;不通过&apos;, &apos;取消&apos;]
        ,yes: function(index){
            $(this).data({&apos;check&apos;:1,&apos;tablename&apos;:&apos;classes&apos;});
            Table.api.multi(&quot;checkall&quot;, ids, table, $(this));
            Layer.close(index);
              }
        ,btn2: function(index){
            $(this).data({&apos;check&apos;:2,&apos;tablename&apos;:&apos;classes&apos;});
            Table.api.multi(&quot;checkall&quot;, ids, table, $(this));
            Layer.close(index);
             }
        ,btn3: function(index){
            Layer.close(index);
        }
    });
});</code></pre><p>其中Table.config.checkallbtn即之前在config中添加的按钮，其中绑定的类名必须在之前的buildtollbar的对应按钮上有，根据需求，这里设置一个弹窗，以点击通过为例：<br>鼠标选择几项结果之后进行批量审核，如果选择通过，对应回调yes，此时设置两个数据，一个是对应的表，一个是审核状态。因为主要是classes表会用到审核，默认值设置为classes表，如果其他方法调用，可以在对应的js文件中重写绑定事件；（还有另一种方法，config中添加一项为tablename,然后直接传tablename,将对应的classes修改为Table.config.tablename,每次页面js调用的时候修改config，但是因为大部分页面用不着重写config,因此这里不这么写）<br>multi方法即批量操作方法，因此这里应该直接调用，在multi方法中有以下的一句：<br>var url = typeof data.url !== “undefined” ? data.url : (action == “del” ? options.extend.del_url : options.extend.multi_url);</p>
<p>这里要注意的是，在js调用的时候打印url，可能审核方法不在，因为实际上multi方法是绑定到dek_url或者multi_url的，这里有两种方法，一种是把check_url替换上去，一种是直接把multi_url方法绑定到check上，也可以直接加上，但是这个判断就要改。</p>
<p>具体js<br>进入到控制器对应的js中调用方法，如果写在trait中，每个控制器都会直接继承，如果使用的地方较少，可以直接使用。地址是admin/library/traits/Backend.php<br>checkall方法如下：</p>
<pre><code>/**
     *
     * 批量审核
     */
    public function checkall($ids = &quot;&quot;)
    {
        $row = $this-&gt;model-&gt;get($ids);
        if (!$row)
            $this-&gt;error(__(&apos;No Results were found&apos;));
        $adminIds = $this-&gt;getDataLimitAdminIds();
        if (is_array($adminIds)) {
            if (!in_array($row[$this-&gt;dataLimitField], $adminIds)) {
                $this-&gt;error(__(&apos;You have no permission&apos;));
            }
        }
        if ($this-&gt;request-&gt;isPost()) {
            $values = $this-&gt;request-&gt;post()[&apos;params&apos;];
            if($values)
            {
                $res =Db::name($values[&apos;tablename&apos;])-&gt;where(&apos;id&apos;,&apos;IN&apos;,$ids)-&gt;update([&apos;check&apos;=&gt;$values[&apos;check&apos;]]);
                $this-&gt;success();
            }
        }
    }</code></pre><p>其中$this-&gt;request-&gt;post()[‘params’]可以获取到刚才在js中传递的数据，这里是用户选择的审核状态和需要更新的表名；之后对表进行操作返回$this-&gt;success()就可以了；</p>
<p>添加权限<br>以上操作顺利完成之后显示的会是没有操作权限；首先进入规则管理，添加刚才新增的方法对应的规则，例如这里添加的是check:</p>
<p><img src="https://segmentfault.com/img/bVba37O?w=736&h=333" alt="clipboard.png"></p>
<p>只要不以菜单方式显示，然后状态正常就可以了；<br>之后进入角色组，在角色组对应的权限中勾选，此时就可以加上对应的权限，这是很重要的一步：</p>
<pre><code>**接下来在index页面中加上验证就行，例如这里是：
data-operate-check=&quot;{:$auth-&gt;check(&apos;course/clabelong/check&apos;)}&quot;
data-operate-checkall=&quot;{:$auth-&gt;check(&apos;course/clabelong/checkall&apos;)}&quot;**</code></pre><p>此时再登录不同的用户，例如教师组没有批量审核权限，那么无法显示批量审核按钮。</p>
<p>单个操作权限<br>除了批量操作，其实还可以单个操作，单个操作和批量操作稍有不同，但是更简单。可以仿照单元格元素事件来写，结果如下：</p>
<pre><code>&apos;click .btn-checkone&apos;: function (e, value, row, index) {
                        e.stopPropagation();
                        e.preventDefault();
                        var table = $(this).closest(&apos;table&apos;);
                        var options = table.bootstrapTable(&apos;getOptions&apos;);
                        var ids = row[options.pk];
                        row = $.extend({}, row ? row : {}, {ids: ids});
                        var url = options.extend.check_url;
                        Fast.api.open(Table.api.replaceurl(url, row, table), &apos;审核&apos;, $(this).data() || {});
                    },</code></pre><p>直接绑定到check_url，在对应方法的js文件中的extend写出check_url的位置，添加对应的方法和视图，就可以直接调用。当然，同样涉及到权限的问题，加了方法之后在index中依然要用data-operate-check=”{:$auth-&gt;check(‘course/clabelong/check’)}”；同时，不要忘记在require-table.js中添加operate;我添加如下代码：</p>
<pre><code>if (options.extend.check_url !== &apos;&apos;) {
                        buttons.push({
                            name: &apos;check&apos;,
                            icon: &apos;fa fa-flag-checkered&apos;,
                            title: &apos;审核&apos;,
                            classname: &apos;btn btn-xs btn-success btn-checkone&apos;,
                            url: options.extend.check_url
                        });
                    }</code></pre><p>在require-table中可能还有需要修改的地方，但是关键是按照原先的add.del等写好的方法来参照，基本上就不会出错了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.hexiaojiao.top/2019/01/31/test-my-site/" data-id="cka4vkt3y004ug4amajj60rif" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/6/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Leetcode%E5%88%B7%E9%A2%98/">Leetcode刷题</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/crontab/">crontab</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/php/">php</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BB%A3%E7%A0%81%E5%A4%A7%E5%85%A8/">代码大全</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BB%A3%E7%A0%81%E6%95%B4%E6%B4%81%E4%B9%8B%E9%81%93/">代码整洁之道</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%85%B6%E4%BB%96/">其他</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/react/">react</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/react/json-patch/">json-patch</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/typescript/">typescript</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AD%A6%E4%B9%A0/">学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E4%BD%9C/">工作</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E4%BD%9C%E7%BB%8F%E9%AA%8C/">工作经验</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BF%AB%E6%8D%B7%E9%94%AE/">快捷键</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/linux/">linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/linux/%E6%96%87%E4%BB%B6%E7%9B%B8%E5%85%B3/">文件相关</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/linux/%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3/">系统相关</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Hbase/">Hbase</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/">mongodb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/">mysql</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%89%E7%94%A8%E4%BB%A3%E7%A0%81%E6%AE%B5%E6%94%B6%E9%9B%86/">有用代码段收集</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%89%8D%E8%A8%80/">前言</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/">面向对象设计原则</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/demo/" rel="tag">demo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/" rel="tag">go</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tips/" rel="tag">tips</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BC%98%E5%8C%96/" rel="tag">优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BD%BF%E7%94%A8%E5%BF%83%E5%BE%97/" rel="tag">使用心得</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" rel="tag">基础命令</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0/" rel="tag">学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%8F%E5%B7%A5%E5%85%B7/" rel="tag">小工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E4%BD%9C/" rel="tag">工作</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E4%BD%9C%E7%BB%8F%E9%AA%8C/" rel="tag">工作经验</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E6%A1%A3/" rel="tag">文档</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D/" rel="tag">概念介绍</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%8B%E8%AF%95/" rel="tag">测试</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/demo/" style="font-size: 10px;">demo</a> <a href="/tags/go/" style="font-size: 10px;">go</a> <a href="/tags/tips/" style="font-size: 12.5px;">tips</a> <a href="/tags/%E4%BC%98%E5%8C%96/" style="font-size: 10px;">优化</a> <a href="/tags/%E4%BD%BF%E7%94%A8%E5%BF%83%E5%BE%97/" style="font-size: 10px;">使用心得</a> <a href="/tags/%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" style="font-size: 10px;">基础命令</a> <a href="/tags/%E5%AD%A6%E4%B9%A0/" style="font-size: 20px;">学习</a> <a href="/tags/%E5%B0%8F%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">小工具</a> <a href="/tags/%E5%B7%A5%E4%BD%9C/" style="font-size: 15px;">工作</a> <a href="/tags/%E5%B7%A5%E4%BD%9C%E7%BB%8F%E9%AA%8C/" style="font-size: 10px;">工作经验</a> <a href="/tags/%E6%96%87%E6%A1%A3/" style="font-size: 12.5px;">文档</a> <a href="/tags/%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D/" style="font-size: 17.5px;">概念介绍</a> <a href="/tags/%E6%B5%8B%E8%AF%95/" style="font-size: 10px;">测试</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/05/07/design_pattern02/">设计模式从头学习-面向对象设计原则概述</a>
          </li>
        
          <li>
            <a href="/2020/05/07/design_patter01/">设计模式从头学习-前言</a>
          </li>
        
          <li>
            <a href="/2020/04/21/docker01/">《第一本docker书》学习笔记01</a>
          </li>
        
          <li>
            <a href="/2020/04/16/multiArr/">php多维数组相关处理</a>
          </li>
        
          <li>
            <a href="/2020/02/27/linuxOpe/">linux命令大全</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Laurel He<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>